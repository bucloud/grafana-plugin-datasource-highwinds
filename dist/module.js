/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/ui","@grafana/data","@grafana/runtime","rxjs","lodash"],(function(e,t,n,r,a,o){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=58)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t,n){var r=n(54),a=0;e.exports=function(e){var t=++a;return r(e)+t}},function(e,t,n){var r=n(9),a=n(32),o=n(33),i=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":i&&i in Object(e)?a(e):o(e)}},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){var r=n(22),a=n(14),o=n(39),i=n(40),u=Object.prototype,s=u.hasOwnProperty,l=r((function(e,t){e=Object(e);var n=-1,r=t.length,l=r>2?t[2]:void 0;for(l&&o(t[0],t[1],l)&&(r=1);++n<r;)for(var c=t[n],p=i(c),f=-1,d=p.length;++f<d;){var m=p[f],v=e[m];(void 0===v||a(v,u[m])&&!s.call(e,m))&&(e[m]=c[m])}return e}));e.exports=l},function(e,t,n){var r=n(10).Symbol;e.exports=r},function(e,t,n){var r=n(13),a="object"==typeof self&&self&&self.Object===Object&&self,o=r||a||Function("return this")();e.exports=o},function(e,t){e.exports=function(e){return e}},function(e,t,n){var r=n(5),a=n(6);e.exports=function(e){if(!a(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(31))},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){var r=n(12),a=n(16);e.exports=function(e){return null!=e&&a(e.length)&&!r(e)}},function(e,t){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},function(e,t){var n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&n.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t){var n=Array.isArray;e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){e.exports=a},function(e,t){e.exports=o},function(e,t,n){var r=n(11),a=n(23),o=n(25);e.exports=function(e,t){return o(a(e,t,r),e+"")}},function(e,t,n){var r=n(24),a=Math.max;e.exports=function(e,t,n){return t=a(void 0===t?e.length-1:t,0),function(){for(var o=arguments,i=-1,u=a(o.length-t,0),s=Array(u);++i<u;)s[i]=o[t+i];i=-1;for(var l=Array(t+1);++i<t;)l[i]=o[i];return l[t]=n(s),r(e,this,l)}}},function(e,t){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},function(e,t,n){var r=n(26),a=n(38)(r);e.exports=a},function(e,t,n){var r=n(27),a=n(28),o=n(11),i=a?function(e,t){return a(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:o;e.exports=i},function(e,t){e.exports=function(e){return function(){return e}}},function(e,t,n){var r=n(29),a=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=a},function(e,t,n){var r=n(30),a=n(37);e.exports=function(e,t){var n=a(e,t);return r(n)?n:void 0}},function(e,t,n){var r=n(12),a=n(34),o=n(6),i=n(36),u=/^\[object .+?Constructor\]$/,s=Function.prototype,l=Object.prototype,c=s.toString,p=l.hasOwnProperty,f=RegExp("^"+c.call(p).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||a(e))&&(r(e)?f:u).test(i(e))}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(9),a=Object.prototype,o=a.hasOwnProperty,i=a.toString,u=r?r.toStringTag:void 0;e.exports=function(e){var t=o.call(e,u),n=e[u];try{e[u]=void 0;var r=!0}catch(e){}var a=i.call(e);return r&&(t?e[u]=n:delete e[u]),a}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t,n){var r,a=n(35),o=(r=/[^.]+$/.exec(a&&a.keys&&a.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!o&&o in e}},function(e,t,n){var r=n(10)["__core-js_shared__"];e.exports=r},function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t){var n=Date.now;e.exports=function(e){var t=0,r=0;return function(){var a=n(),o=16-(a-r);if(r=a,o>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},function(e,t,n){var r=n(14),a=n(15),o=n(17),i=n(6);e.exports=function(e,t,n){if(!i(n))return!1;var u=typeof t;return!!("number"==u?a(n)&&o(t,n.length):"string"==u&&t in n)&&r(n[t],e)}},function(e,t,n){var r=n(41),a=n(51),o=n(15);e.exports=function(e){return o(e)?r(e,!0):a(e)}},function(e,t,n){var r=n(42),a=n(43),o=n(18),i=n(45),u=n(17),s=n(47),l=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=o(e),c=!n&&a(e),p=!n&&!c&&i(e),f=!n&&!c&&!p&&s(e),d=n||c||p||f,m=d?r(e.length,String):[],v=m.length;for(var h in e)!t&&!l.call(e,h)||d&&("length"==h||p&&("offset"==h||"parent"==h)||f&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||u(h,v))||m.push(h);return m}},function(e,t){e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},function(e,t,n){var r=n(44),a=n(7),o=Object.prototype,i=o.hasOwnProperty,u=o.propertyIsEnumerable,s=r(function(){return arguments}())?r:function(e){return a(e)&&i.call(e,"callee")&&!u.call(e,"callee")};e.exports=s},function(e,t,n){var r=n(5),a=n(7);e.exports=function(e){return a(e)&&"[object Arguments]"==r(e)}},function(e,t,n){(function(e){var r=n(10),a=n(46),o=t&&!t.nodeType&&t,i=o&&"object"==typeof e&&e&&!e.nodeType&&e,u=i&&i.exports===o?r.Buffer:void 0,s=(u?u.isBuffer:void 0)||a;e.exports=s}).call(this,n(19)(e))},function(e,t){e.exports=function(){return!1}},function(e,t,n){var r=n(48),a=n(49),o=n(50),i=o&&o.isTypedArray,u=i?a(i):r;e.exports=u},function(e,t,n){var r=n(5),a=n(16),o=n(7),i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object DataView]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&a(e.length)&&!!i[r(e)]}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,n){(function(e){var r=n(13),a=t&&!t.nodeType&&t,o=a&&"object"==typeof e&&e&&!e.nodeType&&e,i=o&&o.exports===a&&r.process,u=function(){try{var e=o&&o.require&&o.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=u}).call(this,n(19)(e))},function(e,t,n){var r=n(6),a=n(52),o=n(53),i=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return o(e);var t=a(e),n=[];for(var u in e)("constructor"!=u||!t&&i.call(e,u))&&n.push(u);return n}},function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},function(e,t,n){var r=n(55);e.exports=function(e){return null==e?"":r(e)}},function(e,t,n){var r=n(9),a=n(56),o=n(18),i=n(57),u=r?r.prototype:void 0,s=u?u.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return a(t,e)+"";if(i(t))return s?s.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,a=Array(r);++n<r;)a[n]=t(e[n],n,e);return a}},function(e,t,n){var r=n(5),a=n(7);e.exports=function(e){return"symbol"==typeof e||a(e)&&"[object Symbol]"==r(e)}},function(e,t,n){"use strict";n.r(t);var r=n(2),a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function o(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function u(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function u(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}s((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}function l(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i}function c(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e}var p,f,d=n(8),m=n.n(d),v=n(20),h=n(3);!function(e){e.PT5M="PT5M",e.PT1H="PT1H",e.P1D="P1D",e.P1M="P1M"}(p||(p={})),function(e){e.ACCOUNT="ACCOUNT",e.HOST="HOST",e.PLATFORM="PLATFORM",e.POP="POP",e.REGION="REGION",e.STATUS="STATUS",e.STATUS_CATEGORY="STATUS_CATEGORY"}(f||(f={}));var g={type:"transfer",filters:{platforms:"DELIVERY",groupBy:f.ACCOUNT,granularity:p.PT1H},metrics:"xferUsedTotalMB"},b=function(e){function t(t){var n=e.call(this,t)||this;return n.dsSettings=t,n}return o(t,e),t.prototype.metricFindQuery=function(e){var t;try{t=JSON.parse(e)}catch(n){console.log(n),t={query:e}}switch(t.query.toUpperCase()){case"POP_CODE":return this.get("/api/v1/pops").then((function(e){return e.list.map((function(e){return{value:e.code,text:e.name}}))}));case"POP_COUNTRY":return this.get("/api/v1/pops").then((function(e){var t=[];return e.list.map((function(e){return{text:e.country,value:e.country}})).filter((function(e){return!t.includes(e.value)&&(t.push(e.value),!0)}))}));case"POP_GROUP":return this.get("/api/v1/pops").then((function(e){var t=[];return e.list.map((function(e){return{text:e.group,value:e.group}})).filter((function(e){return!t.includes(e.value)&&(t.push(e.value),!0)}))}));case"POP_REGION":return this.get("/api/v1/pops").then((function(e){var t=[];return e.list.map((function(e){return{text:e.region,value:e.region}})).filter((function(e){return!t.includes(e.value)&&(t.push(e.value),!0)}))}));default:return Promise.resolve([])}},t.prototype.query=function(e){var t=this,n=e.range,a=n.from.utc().format("YYYY-MM-DDTHH:mm:ss\\Z"),o=n.to.utc().format("YYYY-MM-DDTHH:mm:ss\\Z");console.log(Object(h.getTemplateSrv)().getVariables().map((function(e){console.log(e,e.label,e.name,e.type,e.toString())}))),e.targets.map((function(e){return e.filters.startDate=a,e.filters.endDate=o,e}));var i=e.targets.map((function(n){var a=m()(n,g);return console.log(Object(h.getTemplateSrv)().replace(Object.entries(n.filters).map((function(e){return e[0]+"="+e[1]})).join("&"),e.scopedVars)),r.ExploreMode.Logs===e.exploreMode?t.log(a).then((function(e){return{data:[e],key:n.refId}})):t.analytics(a,e.scopedVars).then((function(e){return{data:[e],key:n.refId}}))}));return v.merge.apply(void 0,c(i))},t.prototype.log=function(e){return this.get("/api/v1/accounts/"+(e.accountHash||this.dsSettings.jsonData.defaultAccountHash)+"/analytics/"+e.type+"?"+Object.entries(e.filters).map((function(e){return e[0]+"="+e[1]})).join("&")).then((function(t){var n,a=(null===(n=e.metrics)||void 0===n?void 0:n.split(","))||[],o=t.series.filter((function(e){return e.data.length>0}));if(0===o.length)throw{message:"null data"};var i=Object.entries(o[0].metrics).filter((function(e){return a.includes(e[1])})).map((function(e){return parseInt(e[0],10)}));if(0===i.length)throw{message:"Metrics not found"};var u=[];u.push({name:"usageTime",values:o[0].data.map((function(e){return e[0]})),type:r.FieldType.time}),a.forEach((function(e,t){u.push.apply(u,c(o.map((function(n){return{name:n.key+"."+e,values:n.data.map((function(e){return e[i[t]]})),type:e.endsWith("Time")?r.FieldType.time:r.FieldType.string}}))))}))}))},t.prototype.analytics=function(e,t){var n;if(void 0===t&&(t={}),0===(null===(n=e.metrics)||void 0===n?void 0:n.split(",").length))throw{message:"Mertics not set"};return this.get("/api/v1/accounts/"+(e.accountHash||this.dsSettings.jsonData.defaultAccountHash)+"/analytics/"+e.type+"?"+Object(h.getTemplateSrv)().replace(Object.entries(e.filters).map((function(e){return e[0]+"="+e[1]})).join("&"),t)).then((function(t){var n,a=(null===(n=e.metrics)||void 0===n?void 0:n.split(","))||[],o=a.length,i=t.series.filter((function(e){return e.data.length>0}));if(0===i.length)throw{message:"null data"};var u=Object.entries(i[0].metrics).filter((function(e){return a.includes(e[1])})).map((function(e){return parseInt(e[0],10)}));if(0===u.length)throw{message:"Metrics not found"};var s=[];return s.push({name:"usageTime",values:i[0].data.map((function(e){return e[0]})),type:r.FieldType.time}),a.forEach((function(e,t){s.push.apply(s,c(i.map((function(n){return{name:1===o?n.key:1===i.length?e:n.key+"."+e,values:n.data.map((function(e){return e[u[t]]})),type:e.endsWith("Time")?r.FieldType.time:r.FieldType.number}}))))})),{refId:e.refId,fields:s}}))},t.prototype.get=function(e,t){return this.request("GET",e,t).then((function(e){return e.data})).catch((function(e){if(e.data&&e.data.error)throw{message:"Request error: "+e.data.error,error:e.data.error};throw e}))},t.prototype.request=function(e,t,n){var r,a={url:this.dsSettings.url+t,method:e,headers:{Authorization:"Bearer "+this.dsSettings.jsonData.apiKey}};return Object.assign.apply(Object,c([a.headers],(null===(r=this.dsSettings.jsonData.customHeaders)||void 0===r?void 0:r.map((function(e){var t;return(t={})[e.name]=e.value,t})))||[])),a.withCredentials=!1,Object(h.getBackendSrv)().datasourceRequest(a)},t.prototype.testDatasource=function(){return u(this,void 0,void 0,(function(){return s(this,(function(e){return[2,this.get("/api/v1/users/me").then((function(e){return e?{status:"success",message:"Success"}:{status:"failed",message:"unknow error"}})).catch((function(e){return{status:"failed",message:e.message+", Please check your accessToken"}}))]}))}))},t}(r.DataSourceApi),y=n(0),x=n.n(y),M=n(1),S=n(4),O=n.n(S),T=M.LegacyForms.FormField,j=function(e){var t=e.header,n=e.onBlur,r=e.onChange,a=e.onRemove,o=e.onReset;return x.a.createElement("div",{style:{display:"flex",marginBottom:"4px"}},x.a.createElement(T,{label:"Header",name:"name",placeholder:"X-Custom-Header",labelWidth:5,value:t.name||"",onChange:function(e){return r(i(i({},t),{name:e.target.value}))},onBlur:n}),x.a.createElement(T,{label:"Value",name:"value",type:"password",value:t.value,labelWidth:5,inputWidth:t.configured?11:12,placeholder:"Header Value",onReset:function(){return o(t.id)},onChange:function(e){return r(i(i({},t),{value:e.target.value}))},onBlur:n}),x.a.createElement(M.Button,{variant:"secondary",size:"xs",onClick:function(e){return a(t.id)}},x.a.createElement(M.Icon,{name:"trash-alt"})))},C=function(e){function t(t){var n=e.call(this,t)||this;n.state={headers:[]},n.onAPIKeyChange=function(e){var t=n.props,r=t.onOptionsChange,a=t.options;r(i(i({},a),{jsonData:i(i({},a.jsonData),{apiKey:e.target.value})}))},n.onApiBaseChange=function(e){var t=n.props,r=t.onOptionsChange,a=t.options,o=i(i({},a.jsonData),{url:e.target.value});r(i(i({},a),{jsonData:o}))},n.onAccountHashChange=function(e){var t=n.props,r=t.onOptionsChange,a=t.options,o=i(i({},a.jsonData),{defaultAccountHash:e.target.value});r(i(i({},a),{jsonData:o}))},n.updateSettings=function(){var e=n.state.headers,t=n.props.options.jsonData,r=n.props.options.secureJsonData||{};t.customHeaders=e,n.props.onOptionsChange(i(i({},n.props.options),{jsonData:t,secureJsonData:r}))},n.onHeaderAdd=function(){n.setState((function(e){return{headers:c(e.headers,[{id:O()(),name:"",value:"",configured:!1}])}}),n.updateSettings)},n.onHeaderChange=function(e,t){n.setState((function(n){return{headers:n.headers.map((function(n,r){return e!==r?n:i({},t)}))}}),n.updateSettings)},n.onHeaderReset=function(e){n.setState((function(t){return{headers:t.headers.map((function(t,n){return t.id!==e?t:i(i({},t),{value:"",configured:!1})}))}}))},n.onHeaderRemove=function(e){n.setState((function(t){return{headers:t.headers.filter((function(t){return t.id!==e}))}}),n.updateSettings)};var r=n.props.options.jsonData;t.options.url.length<=1&&(t.options.url="https://striketracker.highwinds.com");var a=r.customHeaders||[];return n.state={headers:a},n}return o(t,e),t.prototype.render=function(){var e=this,t=this.props.options.jsonData,n=t.customHeaders||[];return x.a.createElement("div",{className:"gf-form-group"},x.a.createElement(M.Legend,null,"Striketracker3 Settings"),x.a.createElement("div",{className:"gf-form"},x.a.createElement(T,{label:"ApiBase",labelWidth:10,inputWidth:20,onChange:this.onApiBaseChange,value:t.url||this.props.options.url,placeholder:"Striketracker API hostname"})),x.a.createElement("div",{className:"gf-form"},x.a.createElement(T,{label:"AccessToken",labelWidth:10,inputWidth:20,type:"password",onChange:this.onAPIKeyChange,value:t.apiKey||"",placeholder:"AccessToken to access endpoint"})),x.a.createElement("div",{className:"gf-form"},x.a.createElement(T,{label:"DefaultAccountHash",labelWidth:10,inputWidth:20,onChange:this.onAccountHashChange,value:t.defaultAccountHash||"",placeholder:"Default accountHash like a1b1c1d1"})),x.a.createElement(M.Legend,{style:{marginTop:"20px"}},"Custom Headers Settings"),x.a.createElement("div",{className:"gf-form-group"},n.map((function(t,n){return x.a.createElement(j,{key:t.id,header:t,onChange:function(t){e.onHeaderChange(n,t)},onBlur:function(){},onRemove:e.onHeaderRemove,onReset:e.onHeaderReset})}))),x.a.createElement("div",{className:"gf-form"},x.a.createElement(M.Button,{variant:"secondary",icon:"plus",onClick:function(t){e.onHeaderAdd()}},"Add header")))},t}(y.PureComponent);function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var w=[{label:"RequestsCount",value:"requestsCountTotal",description:"total requests"},{label:"RequestPerSecond",value:"rps",description:"requests per second, calculated as total requests divided by number of seconds in bucket"}],A=c([{value:"xferUsedTotalMB",description:"total MB transferred",label:"xferUsedTotalMB"},{value:"xferUsedMinMB",description:"minimum five minute bucket of MB transferred",label:"xferUsedMinMB"},{value:"xferUsedMaxMB",description:"maximum five minute bucket of MB transferred",label:"xferUsedMaxMB"},{value:"xferUsedMeanMB",description:"average of five minute buckets of MB transferred",label:"xferUsedMeanMB"},{value:"xferAttemptedTotalMB",description:"total MB attempted",label:"xferAttemptedTotalMB"},{value:"durationTotal",description:"total transfer time of all requests",label:"durationTotal"},{value:"xferRateMaxMbps",description:"maximum transfer rate",label:"xferRateMaxMbps"},{value:"xferRateMaxUsageTime",description:"timestamp at which maximum transfer rate occurred",label:"xferRateMaxUsageTime"},{value:"xferRateMinMbps",description:"minimum transfer rate",label:"xferRateMinMbps"},{value:"xferRateMinUsageTime",description:"timestamp at which minimum transfer rate occurred",label:"xferRateMinUsageTime"},{value:"xferRateMeanMbps",description:"average transfer rate",label:"xferRateMeanMbps"},{value:"requestsCountMin",description:"minimum five minute bucket of requests per second",label:"requestsCountMin"},{value:"requestsCountMax",description:"maximum five minute bucket of requests per second",label:"requestsCountMax"},{value:"requestsCountMean",description:"average of five minute bucket requests per second",label:"requestsCountMean"},{value:"rpsMax",description:"maximum requests per second",label:"rpsMax"},{value:"rpsMaxUsageTime",description:"timestamp at which maximum requests per second occurred",label:"rpsMaxUsageTime"},{value:"rpsMin",description:"minimum requests per second",label:"rpsMin"},{value:"rpsMinUsageTime",description:"timestamp at which minimum requests per second occurred",label:"rpsMinUsageTime"},{value:"rpsMean",description:"mean requests per second",label:"rpsMean"},{value:"lastUpdatedTime",description:"last time this bucket was updated",label:"lastUpdatedTime"},{value:"xferRateMbps",description:"average transfer rate in Mbps",label:"xferRateMbps"},{value:"userXferRateMbps",description:"total transfer divided by duration",label:"userXferRateMbps"},{value:"completionRatio",description:"completed requests divided by attempted requests",label:"completionRatio"},{value:"responseSizeMeanMB",description:"total MB transferred divided by number of requests",label:"responseSizeMeanMB"},{value:"peakToMeanMBRatio",description:"maximum transfer rate divided by mean transfer rate",label:"peakToMeanMBRatio"},{value:"peakToMeanRequestsRatio",description:"maximum requests per second divided by mean requests per second",label:"peakToMeanRequestsRatio"}],w),P=[{value:"edgeStorageTotalB",description:"total bytes stored on every edge, may contain duplicate assets",label:"edgeStorageTotalB"},{value:"edgeStorageMaxB",description:"maximum five minute bucket of bytes stored",label:"edgeStorageMaxB"},{value:"edgeStorageMaxUsageTime",description:"timestamp at which maximum bytes stored occurred",label:"edgeStorageMaxUsageTime"},{value:"edgeStorageMinB",description:"minimum five minute bucket of bytes stored",label:"edgeStorageMinB"},{value:"edgeStorageMinUsageTime",description:"timestamp at which minimum bytes stored occurred",label:"edgeStorageMinUsageTime"},{value:"edgeStorageMeanB",description:"average of five minute bucket bytes stored",label:"edgeStorageMeanB"},{value:"edgeFileCountTotal",description:"total assets stored on every edge, may contain duplicate assets",label:"edgeFileCountTotal"},{value:"edgeFileCountMax",description:"maximum five minute bucket of files stored",label:"edgeFileCountMax"},{value:"edgeFileCountMaxUsageTime",description:"timestamp at which maximum files stored occurred",label:"edgeFileCountMaxUsageTime"},{value:"edgeFileCountMin",description:"minimum five minute bucket of files stored",label:"edgeFileCountMin"},{value:"edgeFileCountMinUsageTime",description:"timestamp at which minimum files stored occurred",label:"edgeFileCountMinUsageTime"},{value:"edgeFileCountMean",description:"average of five minute bucket files stored",label:"edgeFileCountMean"},{value:"edgeFileSizeMeanB",description:"average of five minute bucket bytes stored",label:"edgeFileSizeMeanB"},{value:"lastUpdatedTime",description:"last time this bucket was updated",label:"lastUpdatedTime"}],H=[{value:"billingRegions",description:"region to filter by",label:"Region"},{value:"pops",description:"pop list to filter by",label:"POPs"},{value:"accounts",description:"account hashes to filter by",label:"accountHashs"},{value:"hosts",description:"host hashes to filter by",label:"Hosts"}],B=c([{value:"statusCodes",description:"3 digit http status codes to filter by",label:"StatusCodes"},{value:"statusCategories",description:"1 digit http status codes categories to filter by",label:"StatusCategories"}],H),R=[{value:"PLATFORM",description:"group by platform",label:"PLATFORM"},{value:"REGION",description:"group by region",label:"REGION"},{value:"ACCOUNT",description:"group by account",label:"ACCOUNT"},{value:"POP",description:"group by pop",label:"POP"},{value:"HOST",description:"group by host",label:"HOST"}],k=c([{value:"STATUS",description:"group by status code",label:"STATUS_CODE"},{value:"STATUS_CATEGORY",description:"group by status category",label:"STATUS_CATEGORY"}],R),D=[{value:"DELIVERY",description:"Delivery(include http&https)",label:"Delivery"},{value:"SHIELDING",description:"Origin Shield",label:"Origin Shield"},{value:"INGEST",description:"Ingest (include http&https ingest)",label:"Ingest"},{value:"CDS",description:"Delivery(only http)",label:"Http Delivery"},{value:"SDS",description:"Delivery(only https)",label:"Https Delivery"},{value:"CDD",description:"Origin Shield(only http)",label:"Http Shield"},{value:"SDD",description:"Origin Shield(only https)",label:"Https Shield"},{value:"CDI",description:"Ingest(only http)",label:"Http Ingest"},{value:"SDI",description:"Ingest(only https)",label:"Https Ingest"}];var U=function(e){function t(t){var n,r,a,o=e.call(this,t)||this;o.forceAccount="",o.updateOptions=function(){var e,t,n=o.props,r=n.options,a=n.onChange,u={};Object.assign.apply(Object,c([u],null===(e=o.state.filter)||void 0===e?void 0:e.map((function(e){var t;return(t={})[e.name]=e.value.map((function(e){return e.value})).join(","),t})))),a(i(i({},r),{metrics:null===(t=o.state.metrics)||void 0===t?void 0:t.join(","),type:o.state.type,accountHash:o.state.accountHash.value,filters:i(i({},u),{groupBy:o.state.groupBy,platforms:o.state.platforms.join(","),granularity:o.state.interval})}))};var u=o.props,s=u.options,l=u.ds,f=B.map((function(e){return e.value}));return o.forceAccount=l.dsSettings.jsonData.defaultAccountHash,o.state={metrics:(null===(n=s.metrics)||void 0===n?void 0:n.split(","))||[],filter:Object.entries(s.filters).filter((function(e){return f.includes(e[0])})).map((function(e){return{name:e[0],value:e[1].split(","),id:O()()}})),groupBy:(null===(r=s.filters)||void 0===r?void 0:r.groupBy)||"ACCOUNT",platforms:null===(a=s.filters)||void 0===a?void 0:a.platforms.split(","),type:"transfer",accountHash:{label:"default: "+l.dsSettings.jsonData.defaultAccountHash,value:l.dsSettings.jsonData.defaultAccountHash},interval:p.PT1H},o}return o(t,e),t.prototype.render=function(){var e,t,n,r=this,a=function(e){switch("object"===E(e)?e.type:e){case"status":return{Metrics:w,Filter:B,GroupBy:k};case"storage":return{Metrics:P,Filter:H,GroupBy:R};default:return{Metrics:A,Filter:H,GroupBy:R}}}(this.state.type);0===this.state.metrics.length&&this.setState(i(i({},this.state),{metrics:Array(a.Metrics[0])}));var o=function(e){r.setState((function(t){return i(i({},t),e)}),r.updateOptions)},u=function(e){var t,n,a=r.state.filter;0===(null===(t=a)||void 0===t?void 0:t.filter((function(t){return t.id===e.id})).length)?a.push(e):a=null===(n=a)||void 0===n?void 0:n.map((function(t){return t.id===e.id?i(i({},t),e):t})),r.setState((function(e){return i(i({},e),{filter:a})}),0===e.value.length?function(){}:r.updateOptions)},s=function(e,t){void 0===t&&(t="pops");var n=r.props.ds;return new Promise((function(a){return a("pops"===t?n.get("/api/v1/pops").then((function(e){return e.list.map((function(e){return{label:e.country+": "+e.code,value:e.code}}))})):"accounts"===t||"hosts"===t?n.get("/api/v1/accounts/"+r.forceAccount+"/search?search="+e).then((function(e){return"hosts"===t?e.hostnames.map((function(e){return{label:e.name+"("+e.hostHash+(e.accountHash!==r.state.accountHash.value?" below to account"+e.accountHash:"")+")",value:e.hostHash}})):"accounts"===t?e.accounts.map((function(e){return{label:e.accountHash+"("+e.accountName+" => "+e.parent+")",value:e.accountHash}})):void 0})):"billingRegions"===t?[{label:"North America + Europe",value:"us"},{label:"Asia",value:"as"},{label:"South America",value:"sa"},{label:"Oceania",value:"oc"}]:[])}))};return x.a.createElement(x.a.Fragment,null,x.a.createElement("div",{style:{marginBottom:4}},x.a.createElement(M.HorizontalGroup,null,x.a.createElement("label",{className:"gf-form-label width-6 query-keyword",style:{marginRight:0}},"Metrics Type"),x.a.createElement(M.Select,{options:[{label:"Transfer/Bandwidth",value:"transfer"},{label:"statusCode",value:"status"},{label:"CachedObjects",value:"storage"}],onChange:function(e){return o({type:e.value})},defaultValue:"transfer",value:this.state.type}),x.a.createElement("label",{className:"gf-form-label width-6 query-keyword",style:{marginRight:0}},"For Account"),x.a.createElement(M.AsyncSelect,{loadOptions:function(e){return s(e,"accounts")},defaultOptions:!0,onChange:function(e){return o({accountHash:e})},value:this.state.accountHash}))),x.a.createElement("div",{style:{marginBottom:4}},x.a.createElement(M.HorizontalGroup,null,x.a.createElement("label",{className:"gf-form-label width-6 query-keyword",style:{marginRight:0}},"Metrics"),x.a.createElement(M.MultiSelect,{options:a.Metrics,onChange:function(e){return o({metrics:e.map((function(e){return e.value}))})},value:this.state.metrics,defaultValue:a.Metrics[0],placeholder:"Choose metrics to display",invalid:0===(null===(e=this.state.metrics)||void 0===e?void 0:e.length),width:75}))),x.a.createElement("div",{style:{marginBottom:4}},x.a.createElement(M.HorizontalGroup,null,x.a.createElement("label",{className:"gf-form-label width-6 query-keyword",style:{marginRight:0}},"*Platforms"),x.a.createElement(M.MultiSelect,{options:this.state.platforms.find((function(e){return["DELIVERY","INGEST","SHIELDING"].includes(e)}))?D.slice(0,3):this.state.platforms.length?D.slice(3):D,onChange:function(e){o({platforms:e.map((function(e){return e.value}))})},width:25,value:this.state.platforms,invalid:0===this.state.platforms.length}))),x.a.createElement("div",{style:{marginBottom:4}},x.a.createElement(M.HorizontalGroup,null,x.a.createElement("label",{className:"gf-form-label width-6 query-keyword",style:{marginRight:0}},"GroupBy"),x.a.createElement(M.Select,{options:a.GroupBy,onChange:function(e){o({groupBy:e.value})},width:25,value:this.state.groupBy}))),x.a.createElement("div",{style:{marginBottom:4}},x.a.createElement(M.HorizontalGroup,null,x.a.createElement("label",{className:"gf-form-label width-6 query-keyword",style:{marginRight:0}},"Granularity"),x.a.createElement(M.Select,{options:[{value:"PT5M",label:"5 Minutes"},{value:"PT1H",label:"1 Hour"},{value:"P1D",label:"1 Day"},{value:"P1M",label:"1 Month"}],onChange:function(e){o({interval:e.value})},width:25,value:this.state.interval}))),null===(t=this.state.filter)||void 0===t?void 0:t.map((function(e){return x.a.createElement("div",{style:{marginBottom:4,width:"100%"}},x.a.createElement(M.HorizontalGroup,null,x.a.createElement("label",{className:"gf-form-label width-6 query-keyword",style:{marginRight:0}},"Filter"),x.a.createElement(M.Select,{width:25,options:a.Filter.filter((function(t){var n;return!(null===(n=r.state.filter)||void 0===n?void 0:n.map((function(e){return e.name})).includes(t.value))||t.value===e.name})),onChange:function(t){u({id:e.id,name:t.value||"empty",value:[]})},value:e.name}),x.a.createElement(M.AsyncMultiSelect,{loadOptions:function(t){return s(t,e.name)},value:e.value,width:42,defaultOptions:!0,onChange:function(t){u({id:e.id,name:e.name,value:t})},allowCustomValue:!0,disabled:"empty"===e.name,onCreateOption:function(t){var n,a;n=e.id,a=t,r.setState((function(e){var t;return i(i({},e),{filter:null===(t=e.filter)||void 0===t?void 0:t.map((function(e){return e.id===n?i(i({},e),{value:c(e.value,[{label:a,value:a}]),customOptions:c([{value:a,label:a}],e.customOptions||[])}):e}))})}),r.updateOptions)}}),x.a.createElement(M.Button,{variant:"secondary",size:"xs",onClick:function(t){var n,a;n=e.id,a=r.state.filter,r.setState((function(e){var t;return i(i({},e),{filter:null===(t=a)||void 0===t?void 0:t.filter((function(e){return e.id!==n}))})}),r.updateOptions)}},x.a.createElement(M.Icon,{name:"trash-alt"}))))})),a.Filter.length>((null===(n=this.state.filter)||void 0===n?void 0:n.length)||0)&&x.a.createElement("div",{className:"gf-form"},x.a.createElement(M.Button,{variant:"secondary",icon:"plus",onClick:function(e){var t,n;t={id:O()(),name:"empty",value:[]},n=r.state.filter,r.setState((function(e){return i(i({},e),{filter:c(n,[t])})}))}},"Add addtional filter")))},t}(x.a.Component),q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onOptionsChange=function(e){var n=t.props,r=n.onChange,a=n.query,o=n.onRunQuery;r(i(i({},a),e)),o()},t}return o(t,e),t.prototype.render=function(){var e=m()(this.props.query,g);return x.a.createElement(x.a.Fragment,null,x.a.createElement(M.InfoBox,{title:"Usage help",url:"https://grafana.com/docs/grafana/latest/variables/advanced-variable-format-options/#csv"},x.a.createElement("p",null,"Only csv format variable is supported")),x.a.createElement(U,{onChange:this.onOptionsChange,ds:this.props.datasource,options:e}))},t.templateUrl="partials/query.editor.html",t}(y.PureComponent),F=n(21),I=[{title:"Addition",expression:"1 + 2",label:"Add two integers"},{title:"Subtraction",expression:"2 - 1",label:"Subtract an integer from another"}];n.d(t,"plugin",(function(){return N}));var N=new r.DataSourcePlugin(b).setConfigEditor(C).setQueryEditor(q).setExploreQueryField((function(e){var t=Object(F.defaults)(e.query,g);return x.a.createElement(U,{options:t,ds:e.datasource,onChange:function(t){var n=e.query,r=e.onChange,a=e.onRunQuery;r&&(r(i(i({},n),t)),a())}})})).setExploreStartPage((function(e){return x.a.createElement("div",null,x.a.createElement("h2",null,"Cheat Sheet"),I.map((function(t,n){return x.a.createElement("div",{className:"cheat-sheet-item",key:n},x.a.createElement("div",{className:"cheat-sheet-item__title"},t.title),t.expression?x.a.createElement("div",{className:"cheat-sheet-item__example",onChange:function(t){return e.exploreMode},onClick:function(n){return e.onClickExample({refId:"A",queryText:t.expression})}},x.a.createElement("code",null,t.expression)):null,x.a.createElement("div",{className:"cheat-sheet-item__label"},t.label))})))}))}])}));
//# sourceMappingURL=module.js.map